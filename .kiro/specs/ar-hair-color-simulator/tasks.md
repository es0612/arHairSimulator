# 実装計画

## 1. プロジェクト基盤とXcodeGen + SPMパッケージ構造の構築

- [ ] 1.1 XcodeGenプロジェクト設定を作成する
  - project.ymlファイルを作成（iOS 15以上、SwiftUI設定）
  - 必要なCapabilities（Camera、ARKit）をYAMLで定義
  - Bundle Identifierとプロジェクト設定を構成
  - Firebase依存関係をpackagesセクションで定義
  - _要件: 9.1, 9.3, プロジェクト管理効率化_

- [ ] 1.2 ビルドスクリプトとCI/CD設定を作成する
  - generate_project.shスクリプトを作成（XcodeGen実行）
  - setup_dependencies.shスクリプトを作成（依存関係解決）
  - clean_build.shスクリプトを作成（クリーンビルド）
  - .gitignoreファイルを設定（Xcodeプロジェクトファイル除外）
  - GitHub Actions CI/CDワークフローを設定
  - _要件: 開発効率化、チーム開発対応_

- [ ] 1.3 SPMローカルパッケージ構造を作成する
  - Packages/Domain パッケージを作成（Entities + Use Cases）
  - Packages/Infrastructure パッケージを作成（ARKit、Firebase、SwiftData）
  - Packages/Presentation パッケージを作成（ViewModels、Presenters）
  - 各パッケージのPackage.swiftファイルを設定
  - project.ymlでローカルパッケージ依存関係を定義
  - _要件: 全般的なアーキテクチャ要件_

- [ ] 1.4 Swift Testingテスト環境をセットアップする
  - 各パッケージにTestsディレクトリを作成
  - Swift Testingフレームワークを統合
  - project.ymlでテスト実行用のスキームを設定
  - CI/CDでのパッケージ並列テスト設定を準備
  - _要件: 開発効率とコード品質_

## 2. ドメインモデルとコアエンティティの実装（TDD）

- [ ] 2.1 HairColorエンティティをテストファーストで実装する
  - HairColorのテストケースを作成（色変換、カテゴリ分類）
  - HairColor構造体を実装（hue、saturation、brightness）
  - ColorCategoryエニュメーションを実装
  - 色の妥当性検証ロジックを実装
  - _要件: 3.1, 3.2_

- [ ] 2.2 Userエンティティとプロフィール管理を実装する
  - Userモデルのテストケースを作成
  - User、UserProfile、UserPreferences構造体を実装
  - HairType、SkinTone、FaceShapeエニュメーションを実装
  - プロフィール妥当性検証を実装
  - _要件: 1.1, 1.2, 1.5_

- [ ] 2.3 SavedSimulationエンティティをSwiftDataで実装する
  - SavedSimulationのテストケースを作成
  - @Modelマクロを使用したSwiftDataモデルを実装
  - 画像データの保存・読み込み機能を実装
  - シミュレーション履歴の管理機能を実装
  - _要件: 5.1, 5.3, 5.4_

## 3. ドメインサービスとユースケースの実装

- [ ] 3.1 髪色適用ユースケースを実装する
  - ApplyHairColorUseCaseのテストケースを作成
  - 髪の検出から色適用までの業務ロジックを実装
  - エラーハンドリング（髪検出失敗、色適用失敗）を実装
  - パフォーマンス要件（30fps）を満たす最適化を実装
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 3.2 色選択とカスタマイズユースケースを実装する
  - ColorSelectionUseCaseのテストケースを作成
  - 色パレット管理とカスタム色作成機能を実装
  - 明度・彩度調整機能を実装
  - グラデーション・ハイライト効果機能を実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ] 3.3 ビフォーアフター比較ユースケースを実装する
  - CompareHairColorUseCaseのテストケースを作成
  - 元画像とシミュレーション画像の比較機能を実装
  - スワイプジェスチャーによる切り替え機能を実装
  - 同一照明・角度での比較保証機能を実装
  - _要件: 4.1, 4.2, 4.3_

## 4. インフラストラクチャ層の実装

- [ ] 4.1 ARKit統合とカメラ管理を実装する
  - ARCameraManagerのテストケース（モック使用）を作成
  - ARKitセッション管理機能を実装
  - フロントカメラでの顔トラッキング機能を実装
  - カメラ権限管理とエラーハンドリングを実装
  - _要件: 2.1, 2.5, 8.1, 9.1_

- [ ] 4.2 Vision Frameworkによる髪セグメンテーションを実装する
  - HairSegmentationServiceのテストケースを作成
  - Vision Frameworkを使用した髪領域検出を実装
  - ARKitの深度情報を活用した精度向上を実装
  - リアルタイム処理のパフォーマンス最適化を実装
  - _要件: 2.2, 2.4, 2.5, 9.2_

- [ ] 4.3 Firebase認証サービスを実装する
  - AuthenticationServiceのテストケース（モック使用）を作成
  - Apple ID、Google、メール認証を実装
  - ゲストモード機能を実装
  - 認証状態管理とエラーハンドリングを実装
  - _要件: 1.1, 1.5, 8.2_

- [ ] 4.4 SwiftDataローカルストレージを実装する
  - LocalStorageServiceのテストケースを作成
  - SwiftDataモデルコンテナの設定を実装
  - シミュレーション履歴の永続化機能を実装
  - データ同期とキャッシュ管理を実装
  - _要件: 5.3, 5.4, 7.2, 7.3_

## 5. プレゼンテーション層とUI実装

- [ ] 5.1 メインカメラビューを実装する
  - CameraViewのSwiftUIビューを実装
  - @Observableを使用したCameraViewModelを実装
  - ARカメラプレビューとリアルタイム髪色適用を実装
  - カメラ操作UI（撮影、録画）を実装
  - _要件: 2.1, 2.3, 5.1, 10.1_

- [ ] 5.2 色選択パレットUIを実装する
  - ColorPaletteViewのSwiftUIビューを実装
  - カテゴリ別色表示（100色以上）を実装
  - 明度・彩度調整スライダーを実装
  - カスタム色作成インターフェースを実装
  - _要件: 3.1, 3.2, 3.3, 10.1_

- [ ] 5.3 ユーザーオンボーディングとチュートリアルを実装する
  - OnboardingViewのSwiftUIビューを実装
  - インタラクティブなARガイド表示を実装
  - カメラ位置調整のビジュアルガイドを実装
  - スキップ可能なチュートリアルフローを実装
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [ ] 5.4 シミュレーション履歴とギャラリーUIを実装する
  - HistoryViewのSwiftUIビューを実装
  - 保存されたシミュレーションのグリッド表示を実装
  - お気に入り機能とタグ分類を実装
  - 履歴からの色再適用機能を実装
  - _要件: 5.3, 5.4, 5.5_

## 6. 保存・共有機能の実装

- [ ] 6.1 画像・動画保存機能を実装する
  - MediaSaveServiceのテストケースを作成
  - 写真・短動画のデバイス保存機能を実装
  - 画像圧縮と品質最適化を実装
  - 保存エラーハンドリングを実装
  - _要件: 5.1, 5.2_

- [ ] 6.2 SNS共有機能を実装する
  - SocialSharingServiceのテストケースを作成
  - Instagram・Twitter連携機能を実装
  - オプションのウォーターマーク機能を実装
  - 共有エラーハンドリングを実装
  - _要件: 5.2_

- [ ] 6.3 Firebase Storageクラウド同期を実装する
  - CloudSyncServiceのテストケースを作成
  - Firebase Storageへの画像アップロード機能を実装
  - オフライン時の同期キュー機能を実装
  - 同期状態管理とエラーハンドリングを実装
  - _要件: 7.3, 8.1_

## 7. オフライン機能とパフォーマンス最適化

- [ ] 7.1 オフライン機能を実装する
  - OfflineManagerのテストケースを作成
  - ローカル色パレットの完全アクセス機能を実装
  - オフライン時のAR処理機能を実装
  - ネットワーク復旧時の自動同期機能を実装
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 7.2 パフォーマンス最適化を実装する
  - パフォーマンステストケースを作成
  - 30fps以上のAR処理最適化を実装
  - メモリ使用量最適化（CVPixelBuffer管理）を実装
  - バックグラウンド処理とメインスレッド保護を実装
  - _要件: 9.2, 9.5_

- [ ] 7.3 キャッシュ管理システムを実装する
  - CacheManagerのテストケースを作成
  - LRUキャッシュによる画像・色データ管理を実装
  - メモリ圧迫時の自動キャッシュクリア機能を実装
  - キャッシュ効率測定とログ機能を実装
  - _要件: パフォーマンス最適化_

## 8. セキュリティとプライバシー実装

- [ ] 8.1 プライバシー保護機能を実装する
  - PrivacyManagerのテストケースを作成
  - ローカル顔データ処理の実装
  - データ匿名化機能を実装
  - GDPR準拠のデータ削除機能を実装
  - _要件: 8.1, 8.3, 8.4_

- [ ] 8.2 認証セキュリティを実装する
  - SecureAuthManagerのテストケースを作成
  - OAuth 2.0準拠の認証フローを実装
  - 安全なトークン保存・更新機能を実装
  - セッション管理とタイムアウト機能を実装
  - _要件: 8.2_

## 9. アクセシビリティと国際化

- [ ] 9.1 アクセシビリティ機能を実装する
  - AccessibilityManagerのテストケースを作成
  - VoiceOver完全対応を実装
  - Dynamic Type対応を実装
  - 高コントラスト表示対応を実装
  - _要件: 10.4_

- [ ] 9.2 多言語対応を実装する
  - LocalizationManagerのテストケースを作成
  - 日本語・英語のLocalizable.stringsを作成
  - 文字列外部化とローカライゼーション機能を実装
  - 右から左言語の将来対応準備を実装
  - _要件: 多言語対応要件_

## 10. 統合テストとUI/UXテスト

- [ ] 10.1 エンドツーエンド統合テストを実装する
  - 実デバイスでのAR + 色適用統合テストを作成
  - Firebase同期の統合テストを作成
  - オフライン→オンライン復旧テストを作成
  - パフォーマンス統合テストを作成
  - _要件: 全体的な機能統合_

- [ ] 10.2 UIテストとアクセシビリティテストを実装する
  - XCTestを使用したUIテストスイートを作成
  - VoiceOver互換性テストを作成
  - パフォーマンステスト（フレームレート、メモリ）を作成
  - ユーザビリティテストシナリオを作成
  - _要件: 10.4, 9.2, 9.5_

## 11. 最終統合とポリッシュ

- [ ] 11.1 アプリ全体の統合とポリッシュを行う
  - 全機能の統合テストを実行
  - UI/UXの最終調整とポリッシュを実施
  - パフォーマンスの最終最適化を実施
  - エラーハンドリングの包括的テストを実施
  - _要件: 全体的な品質要件_

- [ ] 11.2 ベータテストとフィードバック収集を行う
  - TestFlightベータテスト環境を構築
  - 内部テスター（開発チーム）でのテストを実施
  - 外部テスター（美容関係者、ターゲットユーザー）を募集
  - フィードバック収集システムを構築
  - _要件: ユーザビリティとフィードバック_

## 12. App Store最適化（ASO）とメタデータ準備

- [ ] 12.1 App Storeメタデータを最適化する
  - アプリ名の最適化（「ARヘアカラーシミュレーター」）
  - キーワード戦略（ヘアカラー、AR、美容、シミュレーション）
  - アプリ説明文の作成（日本語・英語）
  - カテゴリ選択（ライフスタイル、美容）
  - _要件: App Store発見性向上_

- [ ] 12.2 ビジュアルアセットを作成する
  - アプリアイコンデザイン（複数サイズ対応）
  - App Storeスクリーンショット（iPhone、iPad対応）
  - プレビュー動画作成（30秒以内、AR機能デモ）
  - プロモーション用画像素材作成
  - _要件: 視覚的訴求力向上_

- [ ] 12.3 法的文書とプライバシー対応を完了する
  - プライバシーポリシー作成（GDPR、CCPA準拠）
  - 利用規約作成
  - App Storeプライバシー質問票への回答
  - データ収集・使用に関する透明性確保
  - _要件: 8.2, 法的コンプライアンス_

## 13. マーケティング戦略と事前準備

- [ ] 13.1 ターゲット市場分析とポジショニングを行う
  - 競合アプリ分析（YouCam Makeup、ModiFace等）
  - ターゲットユーザーペルソナ詳細化
  - 価格戦略決定（無料+プレミアム月額500円）
  - 差別化ポイントの明確化（高精度AR、落ち着いたデザイン）
  - _要件: 市場競争力確保_

- [ ] 13.2 プレスキットとマーケティング素材を作成する
  - プレスリリース作成（日本語・英語）
  - 製品紹介動画作成（2-3分、機能デモ）
  - ブログ記事用素材作成
  - インフルエンサー向けプロモーション素材作成
  - _要件: メディア露出準備_

- [ ] 13.3 ソーシャルメディア戦略を構築する
  - 公式SNSアカウント作成（Twitter、Instagram）
  - コンテンツカレンダー作成
  - ハッシュタグ戦略（#ARヘアカラー #美容アプリ #ヘアスタイル）
  - ユーザー生成コンテンツ促進施策
  - _要件: ソーシャル拡散促進_

## 14. パートナーシップとインフルエンサーマーケティング

- [ ] 14.1 美容業界パートナーシップを構築する
  - 美容サロンとの提携交渉
  - ヘアスタイリストとの協力関係構築
  - 美容専門学校での活用提案
  - 美容メディアとの連携
  - _要件: 業界内での認知度向上_

- [ ] 14.2 インフルエンサーマーケティング戦略を実行する
  - 美容系インフルエンサーのリストアップ
  - インフルエンサー向けプロモーションプラン作成
  - コラボレーション企画の提案
  - インフルエンサー専用プロモコード発行
  - _要件: ターゲット層への直接リーチ_

## 15. App Storeリリースと初期運用

- [ ] 15.1 段階的リリース戦略を実行する
  - ソフトローンチ（限定地域での先行リリース）
  - フィードバック収集と緊急修正対応
  - グローバルローンチ準備
  - リリース日の最終決定とアナウンス
  - _要件: リスク最小化リリース_

- [ ] 15.2 リリース日マーケティング活動を実行する
  - プレスリリース配信
  - SNSでのリリース告知
  - インフルエンサーによる同時投稿
  - 美容メディアへの情報提供
  - _要件: リリース時の最大露出_

- [ ] 15.3 初期ユーザー獲得施策を実行する
  - App Store検索広告キャンペーン開始
  - SNS広告キャンペーン（Instagram、TikTok）
  - 初回ダウンロード特典キャンペーン
  - 友達紹介プログラム実装
  - _要件: 初年度5万ダウンロード達成_

## 16. 運用・改善・成長戦略

- [ ] 16.1 ユーザーフィードバック収集システムを構築する
  - アプリ内フィードバック機能実装
  - App Storeレビュー監視システム構築
  - ユーザーサポート体制構築
  - 定期的なユーザーアンケート実施
  - _要件: 継続的改善基盤_

- [ ] 16.2 データ分析とKPI監視システムを構築する
  - Firebase Analyticsダッシュボード構築
  - 主要KPI設定（DAU、MAU、リテンション率、課金率）
  - A/Bテスト基盤構築
  - 収益分析レポート自動化
  - _要件: データドリブン運営_

- [ ] 16.3 継続的機能改善とアップデート計画を策定する
  - ユーザーリクエスト優先度付けシステム
  - 月次アップデート計画策定
  - 新機能開発ロードマップ作成
  - 技術的負債管理計画
  - _要件: 長期的成長戦略_

## 17. 収益化とビジネス拡大

- [ ] 17.1 プレミアム機能とサブスクリプション最適化を行う
  - プレミアム機能の利用状況分析
  - 価格設定の最適化（A/Bテスト）
  - サブスクリプション解約率改善
  - 新しいプレミアム機能の企画・開発
  - _要件: 月額500円サブスクリプション最適化_

- [ ] 17.2 広告収益モデルを検討・実装する
  - Google AdMob統合検討
  - 広告表示タイミングの最適化
  - ユーザー体験を損なわない広告戦略
  - 広告収益とサブスクリプション収益のバランス調整
  - _要件: 収益多様化_

- [ ] 17.3 国際展開戦略を策定・実行する
  - 海外市場調査（アメリカ、ヨーロッパ、アジア）
  - 多言語対応拡大（中国語、韓国語、フランス語等）
  - 現地マーケティングパートナー探索
  - 国際的な美容トレンドへの対応
  - _要件: グローバル展開_

## 18. 長期戦略と技術革新

- [ ] 18.1 次世代技術統合を検討する
  - AI/機械学習による髪質認識精度向上
  - ARKit新機能への対応
  - Apple Vision Pro対応検討
  - 5G活用による高品質リアルタイム処理
  - _要件: 技術的競争優位性維持_

- [ ] 18.2 エコシステム拡張を検討する
  - 美容サロン向けプロ版開発
  - ヘアケア製品メーカーとの連携
  - バーチャル美容コンサルティングサービス
  - AR美容プラットフォーム化
  - _要件: ビジネスモデル拡張_